<div class="room-list-container">
  <h2 class="text-center text-white mb-5">Habitaciones</h2>
  <div class="bg-white p-4 rounded-3 shadow-sm mb-5">
    <form #roomSearchFilter="ngForm">
      <div class="row">
        <div class="col-4">
          <div class="form-floating">
            <select name="roomType" id="roomType" class="form-select" [(ngModel)]="roomSearchParams.type">
              <option value="" selected>Seleccione una opción</option>
              <option value="SENCILLA">Sencilla</option>
              <option value="DOBLE">Doble</option>
              <option value="SUITE">Suite</option>
              <option value="FAMILIAR">Familiar</option>
            </select>
            <label for="roomType">Tipo de Habitación</label>
          </div>
        </div>
        <div class="col-4">
          <div class="form-floating">
            <select name="roomStatus" id="roomStatus" class="form-select" [(ngModel)]="roomSearchParams.status">
              <option value="" selected>Seleccione una opción</option>
              <option value="DISPONIBLE">Disponible</option>
              <option value="NO_DISPONIBLE">No Disponible</option>
              <option value="MANTENIMIENTO">Mantenimiento</option>
              <option value="ASEO">Aseo</option>
            </select>
            <label for="roomStatus">Estado</label>
          </div>
        </div>
        <div class="col-4">
          <button type="submit" class="btn btn-primary w-100 h-100" (click)="searchRooms()">Buscar</button>
        </div>
      </div>
    </form>
  </div>
  <div class="d-flex justify-content-center bg-white my-5 rounded-4 p-5">
    @if (rooms.length) {
    <table class="table table-striped-columns table-hover table-borderless align-middle">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Portada</th>
          <th scope="col">Precio / noche</th>
          <th scope="col">Descripción</th>
          <th scope="col">Estado</th>
          <th scope="col">Tipo</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        @for (room of rooms; track $index) {
        <tr>
          <th scope="row">{{room.idHabitacion}}</th>
          <td>
            <img src="{{ room.imagenes[0] }}" alt="Imagen habitación {{ room.numeroHabitacion }}"
              style="width: 100px; height: 75px; object-fit: cover;" />
          </td>
          <td>{{room.precio | currency:'COP':'symbol-narrow':'1.0' }}</td>
          <td>{{room.descripcion}}</td>
          <td>
            <form action="">
              <select class="form-select" name="roomStatusSelect" id="roomStatusSelect"
                [(ngModel)]="room.estadoHabitacion"
                (change)="updateRoomStatus(room.numeroHabitacion, room.estadoHabitacion)">
                <option value="DISPONIBLE" [selected]="room.estadoHabitacion === 'DISPONIBLE'">Disponible</option>
                <option value="NO_DISPONIBLE" [selected]="room.estadoHabitacion === 'NO_DISPONIBLE'">No Disponible
                </option>
                <option value="MANTENIMIENTO" [selected]="room.estadoHabitacion === 'MANTENIMIENTO'">Mantenimiento
                </option>
                <option value="ASEO" [selected]="room.estadoHabitacion === 'ASEO'">Aseo</option>
              </select>
            </form>
          </td>
          <td>{{room.tipoHabitacion}}</td>
          <td>
            <!-- Acciones -->
            <div class="d-flex justify-content-center gap-3">
              <button class="btn btn-primary" title="Ver detalles" data-bs-toggle="modal"
                data-bs-target="#roomDetailModal" (click)="openRoomDetail(room)"><i class="bi bi-info-lg"></i></button>
              <button class="btn btn-secondary" title="Editar" (click)="editRoom(room.idHabitacion)"><i
                  class="bi bi-pencil-fill"></i></button>
              <button class="btn btn-danger" title="Eliminar" (click)="deleteRoom(room.numeroHabitacion)"><i
                  class="bi bi-trash-fill"></i></button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
    } @else {
    <div class="text-center py-4 text-muted">
      No se encontraron habitaciones
    </div>
    }
  </div>
</div>

<div class="modal fade " id="roomDetailModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="roomDetailModal" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalle habitación</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          (click)="clearRoomDetail()"></button>
      </div>
      <div class="modal-body p-0">
        <div id="roomDetailImg" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            @for (imagenURL of roomDetail?.imagenes; track $index) {
            <div [ngClass]="$index === 0 ? 'carousel-item active' : 'carousel-item'">
              <img src="{{ imagenURL }}" style="object-fit: cover; height: 400px;" class="d-block w-100">
            </div>
            }
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#roomDetailImg" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#roomDetailImg" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
        <div class="room-content">
          <div class="room-header">
            <h3 class="room-name">{{roomDetail?.nombreHabitacion}}</h3>
            @switch (roomDetail?.tipoHabitacion) {
            @case ('SENCILLA') {
            <span class="room-type-badge simple">{{ roomDetail?.tipoHabitacion | uppercase }}</span>
            }
            @case ('DOBLE') {
            <span class="room-type-badge double">{{ roomDetail?.tipoHabitacion | uppercase }}</span>
            }
            @case ('SUITE') {
            <span class="room-type-badge suite">{{ roomDetail?.tipoHabitacion | uppercase }}</span>
            }
            @case ('FAMILIAR') {
            <span class="room-type-badge familiar">{{ roomDetail?.tipoHabitacion | uppercase }}</span>
            }
            }
          </div>

          <div class="room-details">
            <p class="room-description">{{roomDetail?.descripcion}}</p>

            <div class="price-info">
              <span class="price">{{roomDetail?.precio | currency:'COP':'symbol':'1.0'}} / noche</span>
            </div>

            <div class="features">
              @for (comodidad of roomDetail?.comodidades; track $index) {
              <span class="feature">{{getAmenityData(comodidad).label}}</span>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>